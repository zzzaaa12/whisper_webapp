┌─────────────────────────────────────────────────────────────────────────────┐
│                           Whisper 語音轉文字系統流程圖                        │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   用戶輸入      │    │   管理員登入     │    │   Python Client  │
│  YouTube 連結   │    │    (可選)       │    │   發送請求       │
└─────────┬───────┘    └─────────┬───────┘    └─────────┬───────┘
          │                      │                      │
          └──────────────────────┼──────────────────────┘
                                 │
                    ┌─────────────▼─────────────┐
                    │      Flask Web Server     │
                    │   (app.py - 主應用程式)    │
                    └─────────────┬─────────────┘
                                 │
                    ┌─────────────▼─────────────┐
                    │     驗證通行碼            │
                    │   (IP 限制檢查)           │
                    └─────────────┬─────────────┘
                                 │
                    ┌─────────────▼─────────────┐
                    │    Socket.IO 連線建立     │
                    │   (即時日誌回報)          │
                    └─────────────┬─────────────┘
                                 │
                    ┌─────────────▼─────────────┐
                    │   背景工作程序啟動        │
                    │   (Threading)             │
                    └─────────────┬─────────────┘
                                 │
                    ┌─────────────▼─────────────┐
                    │   1. YouTube 音訊下載     │
                    │   (yt-dlp)               │
                    └─────────────┬─────────────┘
                                 │
                    ┌─────────────▼─────────────┐
                    │   2. 音訊檔案處理         │
                    │   (格式轉換/正規化)       │
                    └─────────────┬─────────────┘
                                 │
                    ┌─────────────▼─────────────┐
                    │   3. Whisper 模型載入     │
                    │   (CUDA/CPU 自動選擇)     │
                    └─────────────┬─────────────┘
                                 │
                    ┌─────────────▼─────────────┐
                    │   4. 音訊轉錄處理         │
                    │   (分段處理 + 進度回報)   │
                    └─────────────┬─────────────┘
                                 │
                    ┌─────────────▼─────────────┐
                    │   5. 字幕檔案生成         │
                    │   (.srt 格式)             │
                    └─────────────┬─────────────┘
                                 │
                    ┌─────────────▼─────────────┐
                    │   6. OpenAI GPT 摘要      │
                    │   (結構化摘要生成)        │
                    └─────────────┬─────────────┘
                                 │
                    ┌─────────────▼─────────────┐
                    │   7. 檔案儲存與清理       │
                    │   (摘要存檔 + 音檔刪除)   │
                    └─────────────┬─────────────┘
                                 │
                    ┌─────────────▼─────────────┐
                    │   8. Telegram 發送        │
                    │   (完整摘要內容)          │
                    └─────────────┬─────────────┘
                                 │
                    ┌─────────────▼─────────────┐
                    │   9. 結果回報給用戶       │
                    │   (Web 介面 + API)        │
                    └─────────────┬─────────────┘
                                 │
                    ┌─────────────▼─────────────┐
                    │   10. 用戶查看結果        │
                    │   (摘要頁面/下載檔案)     │
                    └───────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                              詳細子流程                                      │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   音訊下載流程   │    │   轉錄處理流程   │    │   摘要生成流程   │
├─────────────────┤    ├─────────────────┤    ├─────────────────┤
│ • 解析 YouTube  │    │ • 載入 Whisper   │    │ • 讀取字幕檔案   │
│   連結          │    │   模型          │    │ • 提取文字內容   │
│ • 下載音訊檔案  │    │ • 音訊分段處理  │    │ • 結構化摘要     │
│ • 格式轉換      │    │ • 逐段轉錄      │    │ • 生成標題       │
│ • 品質檢查      │    │ • 進度回報      │    │ • 關鍵字提取     │
│ • 檔案儲存      │    │ • 字幕合併      │    │ • 時間戳記       │
└─────────────────┘    └─────────────────┘    └─────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                              錯誤處理流程                                    │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   下載錯誤      │    │   轉錄錯誤      │    │   摘要錯誤      │
├─────────────────┤    ├─────────────────┤    ├─────────────────┤
│ • 連結無效      │    │ • CUDA 錯誤     │    │ • API 限制      │
│ • 網路中斷      │    │ • 記憶體不足    │    │ • 網路問題      │
│ • 磁碟空間不足  │    │ • 音訊格式錯誤  │    │ • 內容過長      │
│ • 權限問題      │    │ • 模型載入失敗  │    │ • 格式錯誤      │
└─────────────────┘    └─────────────────┘    └─────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                              安全機制                                        │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   IP 限制       │    │   通行碼驗證    │    │   檔案清理      │
├─────────────────┤    ├─────────────────┤    ├─────────────────┤
│ • 5次錯誤限制   │    │ • 環境變數驗證  │    │ • 音檔自動刪除  │
│ • 5分鐘封鎖     │    │ • 管理員介面    │    │ • 暫存檔清理    │
│ • 嘗試記錄      │    │ • 登入狀態追蹤  │    │ • 磁碟空間管理  │
│ • 自動解鎖      │    │ • 安全日誌      │    │ • 定期維護      │
└─────────────────┘    └─────────────────┘    └─────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                              用戶介面流程                                    │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   主頁面        │    │   摘要頁面      │    │   管理頁面      │
├─────────────────┤    ├─────────────────┤    ├─────────────────┤
│ • 輸入連結      │    │ • 查看摘要列表  │    │ • 登入嘗試記錄   │
│ • 即時日誌      │    │ • 下載檔案      │    │ • 系統狀態      │
│ • 進度顯示      │    │ • 詳細內容      │    │ • 清除日誌      │
│ • 取消按鈕      │    │ • 搜尋功能      │    │ • 安全設定      │
└─────────────────┘    └─────────────────┘    └─────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                              技術架構                                        │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   前端技術      │    │   後端技術      │    │   外部服務      │
├─────────────────┤    ├─────────────────┤    ├─────────────────┤
│ • HTML5         │    │ • Flask         │    │ • YouTube       │
│ • Bootstrap     │    │ • Socket.IO     │    │ • OpenAI GPT    │
│ • JavaScript    │    │ • Threading     │    │ • Telegram Bot  │
│ • CSS3          │    │ • Whisper       │    │ • CUDA/CPU      │
└─────────────────┘    └─────────────────┘    └─────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                              資料流向                                        │
└─────────────────────────────────────────────────────────────────────────────┘

YouTube URL → Flask App → Background Thread → yt-dlp → Audio File → 
Whisper Model → Transcription → SRT File → OpenAI GPT → Summary → 
File Storage → Telegram Bot → User Interface

┌─────────────────────────────────────────────────────────────────────────────┐
│                              效能優化                                        │
└─────────────────────────────────────────────────────────────────────────────┘

• 背景處理避免阻塞
• CUDA 加速轉錄
• 音訊分段處理
• 記憶體管理
• 檔案自動清理
• 進度即時回報
• 錯誤恢復機制 